<!DOCTYPE html>
<html>
<head></head>

<!-- LIBRERIE GENERICHE PER JQUERY -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-form-validator/2.3.26/jquery.form-validator.min.js"></script>

<!-- FUNZIONI CREATE DA NOI -->
<script src="js/genericFunctions.js"></script>
<script src="js/functions.js"></script>

<!-- LIBRERIA PER DISEGNARE GRAFICI -->
<script src ="https://cdn.plot.ly/plotly-latest.min.js"></script>

<!-- LIBRERIA PER PERSONALIZZAZIONE DEGLI ALERT -->
<script src="js/sweetalert2_mine.js"></script>
<link rel="stylesheet" href="css/sweetalert2_mine.css">

<!-- LIBRERIA PER CARICARE I FILE -->
<script src="js/dropzone.js"></script>
<link rel="stylesheet" href="css/dropzone.css">

<script>createHead();</script>

<body>

<header></header><script>createHeader();</script>

<div class="content">

		<div class="container">

			<form id="myForm" method="post" enctype="multipart/form-data">

	        <!--   Files: <input type="file" id="files" name="files" multiple><br/> -->

	        <input name='positives' name="positive" id="files" type="file" multiple>
  			<input name='negatives' id="files2" type="file" multiple>

	        <div id="selectedFiles"></div>

	        <input type="submit">

    		</form>

		</div>


</body>

<script>

	var selDiv = "";
    var storedFiles = [];
    var nameFilesP = "positive";
    var nameFilesN = "negative";

    var flag = false;

    $(document).ready(function() {

        	$("#files").on("change", handleFileSelect);

        	$("#files2").on("change", handleFileSelect);

        selDiv = $("#selectedFiles");
        $("#myForm").on("submit", handleForm);

        $("body").on("click", ".selFile", removeFile);
    });

    function handleFileSelect(e) {
        var files = e.target.files;
        var filesArr = Array.prototype.slice.call(files);
        filesArr.forEach(function(f) {

            if(!f.type.match("image.*")) {
                return;
            }
            storedFiles.push(f);

            var reader = new FileReader();
            reader.onload = function (e) {
                var html = "<div><img src=\"" + e.target.result + "\" data-file='"+f.name+"' class='selFile' title='Click to remove'>" + f.name + "<br clear=\"left\"/></div>";
                selDiv.append(html);

            }
            reader.readAsDataURL(f);
        });

    }

    function handleForm(e) {
        e.preventDefault();
        var data = new FormData();

        for(var i=0, len=storedFiles.length; i<len; i++) {

        	if(len == 0)
        		flag = true;

        	if(!flag){
            	data.append(nameFilesP, storedFiles[i]);
            	flag = true;
            }else{
            	data.append(nameFilesN, storedFiles[i]);
            }

            flag = true;
        }

        var xhr = new XMLHttpRequest();
        xhr.open('POST', 'SubmitDataset', true);

        xhr.onload = function(e) {
            if(this.status == 200) {
                console.log(e.currentTarget.responseText);
                alert(e.currentTarget.responseText + ' items uploaded.');
            }
        }

        xhr.send(data);
    }

    function removeFile(e) {
        var file = $(this).data("file");
        for(var i=0;i<storedFiles.length;i++) {
            if(storedFiles[i].name === file) {
                storedFiles.splice(i,1);
                break;
            }
        }
        $(this).parent().remove();
    }

  $('#backicon').mouseover(function(){
	$(this).attr('src','ico/back.png');
	});

	$('#backicon').mouseleave(function(){
		$(this).attr('src',"ico/backDARK.png" );
	});

	$('#backicon').click(function(){
		window.history.back();
	});

</script>

</html>
