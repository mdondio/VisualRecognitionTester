<!DOCTYPE html>
<html>
<head></head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="js/genericFunctions.js"></script>
<script src="js/functions.js"></script>
<script src="js/jquery.lazy.min.js"></script>

<script>createHead();</script>

<body>
<header></header><script>createHeader();</script>

	<div class="content">

		<br>

		<form> <!--  action="javascript:startTrain();"  -->
			<div class="column fourth">
				<p class="title center" id="shortnameedit" contenteditable="true"></p>
			</div>
			<div class="column fourth">
				<p class="title center" id="labeledit" contenteditable="true"></p>
			</div>
			<div class="column fourth">
				<button id="saveButton" disabled class="import">Save</button>
			</div>
			<div class="column fourth">
				<button type="submit" class="import">Use</button><button type="submit" class="import">Retrain</button><button type="submit" class="import">Delete</button>
			</div>
		</form>
		
		

		<br> <br> <br> <br> <br> <br>
		
	<div class="row clearfix">

		<div class="column half">
			<p class='title center'>description</p>
			<p class='paragraph center'>this is a short description of the classifier</p>
			<hr class="lineseparator">
			<textarea id="descriptionedit"></textarea>
<!-- 			<div contenteditable="true" id="descriptionedit"></div> -->
		</div>

		<div class="column half">
			<p class='title center'>comments</p>
			<p class='paragraph center'>you can put comments on the behaviour of the classifier</p>
			<hr class="lineseparator">
			<div contenteditable="true" id="commentsedit"></div>
		</div>
		
	</div>
		
		<br> <br> <br>
		
	<div class="row clearfix">

		<div class="column half">
			<p class='title center'>positive images</p>
			<p class='paragraph center'>list of all the pictures containing
				an object representing the category</p>
			<hr class="lineseparator">
			<div id=positiveTrainingGallery></div>
		</div>

		<div class="column half">
			<p class='title center'>negative images</p>
			<p class='paragraph center'>list of all the pictures not
				containing any object representing the category, but similar ones</p>
			<hr class="lineseparator">
			<div id=negativeTrainingGallery></div>
		</div>
		
	</div>


	</div>

</body>

<script>

	//autosize(document.querySelector('textarea'));
	
	$(document).ajaxStop(function () {
      testingLoading();
  	});
  	
  	var flag = 0;
  	
  	if( flag == 0 ){
  		 	
	 	if( $('#saveButton').attr("disabled") ){
	 	
	 		$('#saveButton').css("background", "pink");
	 	
	 	}else
	 		$('#saveButton').css("background", "green");
  	
  		flag = 1;
  		
  	}


	$("#descriptionedit").on("change keyup paste", function(){
    
    	$('#saveButton').attr("disabled", false);
    	$('#saveButton').css("background", "green");
	
	});
	
	$("#commentsedit").on("change keyup paste", function(){
    
    	$('#saveButton').attr("disabled", false);
    	$('#saveButton').css("background", "green");
	
	});
	
	$("#labeledit").on("change keyup paste", function(){
    
    	$('#saveButton').attr("disabled", false);
    	$('#saveButton').css("background", "green");
	
	});
	
	$("#shortnameedit").on("change keyup paste", function(){
    
    	$('#saveButton').attr("disabled", false);
    	$('#saveButton').css("background", "green");
	
	});
  	
  	$('#saveButton').click(function(){
  	
  		var shortName = ( $("#shortnameedit").html() );
  		var descr = ( $("#descriptionedit").html() );
  		var comm = ( $("#commentsedit").html() );
  		var label = ( $("#labeledit").html() );;
  	
  		updateClassifierDetail(classID, shortName, label, descr, comm);
	
	});
  	
	var classID = localStorage.getItem("classID");

	var shortName = returnClassifierDetail(classID, "shortname");
	var label = returnClassifierDetail(classID, "label");
	var descr = returnClassifierDetail(classID, "description");
	var comm = returnClassifierDetail(classID, "comments");

	$("#shortnameedit").text(shortName);
	$("#labeledit").text(label);
	$("#descriptionedit").text(descr);
	$("#commentsedit").text(comm);
	
// 	$("#shortnameedit").focusout(function(){ 	updateClassifierDetail(classID, "shortname", 	($("#shortnameedit").html())	);	}); // VEDERE FUNZIONE
// 	$("#labeledit").focusout(function(){ 		updateClassifierDetail(classID, "label", 		($("#labeledit").html())		);	});
// 	$("#descriptionedit").focusout(function(){ 	updateClassifierDetail(classID, "description",	($("#descriptionedit").html())	);	});
// 	$("#commentsedit").focusout(function(){ 	updateClassifierDetail(classID, "comments",		($("#commentsedit").html())		);	});
	

buildSelectDataSet("all",'#trainingdataset');

	$('#trainingdataset').on(
			'change',
			function() {
			
				var testsetID = $(this).val();
				
				$.ajax({
					contentType : "application/json",
					dataType : "json",
					url : 'GetDataset',
					data : "_id=",
					async : true,
					success : function(result) {
					
						$("#negativeTrainingGallery").empty();
						$("#positiveTrainingGallery").empty();

						for ( var i in result ){

							if (result[i]._id == testsetID) {
								
								var positive_images = [];
								for( var k = 0; k < result[i].images.positive.length; k++ )								
									positive_images.push("GetImage?image_id="+result[i].images.positive[k]);
									
								var negative_images = [];
								for( var j = 0; j < result[i].images.negative.length; j++ )
									negative_images.push("GetImage?image_id="+result[i].images.negative[j]);
								
								createGallery('negativeTrainingGallery', negative_images, result[i]._id + "NEG");
								createGallery('positiveTrainingGallery', positive_images, result[i]._id + "POS");
								$("#labelselected").html(result[i].label);
								$("#labelselected").val(result[i]._id);

							}


						}

					}
				});
				
			});
			
</script>

</html>