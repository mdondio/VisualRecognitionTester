<!DOCTYPE html>
<html>
<head></head>

<!-- LIBRERIE GENERICHE PER JQUERY -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-form-validator/2.3.26/jquery.form-validator.min.js"></script> 

<!-- FUNZIONI CREATE DA NOI -->
<script src="js/genericFunctions.js"></script>
<script src="js/functions.js"></script>

<!-- LIBRERIA PER DISEGNARE GRAFICI -->
<script src ="https://cdn.plot.ly/plotly-latest.min.js"></script>

<!-- LIBRERIA PER PERSONALIZZAZIONE DEGLI ALERT -->
<script src="js/sweetalert2_mine.js"></script>
<link rel="stylesheet" href="css/sweetalert2_mine.css">

<!-- LIBRERIA PER CARICARE I FILE -->
<script src="js/dropzone.js"></script>
<link rel="stylesheet" href="css/dropzone.css">

<script>createHead();</script>

<body>
  <header id="header" style="animation-duration:2s"></header>
  <script>createHeader();</script>
  
<div class="content" id="simulate">
	<div class="row clearfix">
	
		<div class="column third">
			<div class="post-preview" style="width:100%; height:auto">
				<img class="center" src="ico/addDARK.png" style="width:50px;height:auto;">
				<br>
					<h2>Add one more test</h2>
					<div class="card trasp">
						<p style="font-size:18px;color:#A0A0A0">You can run 10 test at the same time</p>
					</div>
			</div>
		</div>
							
	    <div class="column third">
			<div class="post-preview" style="width:100%; height:auto">
				<img class="center" src="ico/uploadDARK.png" style="width:50px;height:auto;">
					<br>
					<h2>Upload a new test dataset</h2>
					<div class="card trasp">
						<p style="font-size:18px;color:#A0A0A0">Upload two .zip files with positive and negative images to set-up a new test data set</p>
					</div>
			</div>
		</div>
							
	    <div class="column third">
			<div class="post-preview" style="width:100%; height:auto">
				<img class="center" src="ico/play-buttonDARK.png" style="width:50px;height:auto;">
					<br>
					<h2>Run your simulation</h2>
					<div class="card trasp">
						<p style="font-size:18px;color:#A0A0A0">When you are ready start your simulation</p>
					</div>			
			</div>
		</div>
		
	</div>
 
    <div class="row clearfix">

    	<div class="column full">

      
      <form id="myForm" action="javascript:startSimulation();"> 
			       <br>    	
      <hr align="center" width="50%" class="middle_division">
      		<div class="sim-buttons">
 				<input type=image id="addicon" class="inline" src="ico/addDARK.png" style="width:60px;height:auto;">
 				<input type=image id="uploadicon" class="inline" src="ico/uploadDARK.png" style="width:60px;height:auto;margin-left:30px;margin-right:30px;"> 
       			<input type=image id="playicon" class="inline" src="ico/play-buttonDARK.png" style="width:60px;height:auto;">
	  		
	  			<hr align="center" width="50%" class="middle_division">
	  		</div>
      <br>
        
	        	<div class="row clearfix moltiplicandum" id="moltiplicandum1" style="margin-bottom:20px;margin-left:200px;">
			        
			        
					<div class="column fourth">
					  <!-- Class name was test_set, in conflict with the next one!  -->
		              <input required class="testName" name="test1" type="text" placeholder="Insert test name" style="width:100%">
		            </div>
		            
		            <div class="column fourth">
		              <select required class="test_set" type="text" style="width:100%">
		                <option selected disabled value="">Select test dataset</option>
		              </select>
		            </div>
		
		            <div class="column fourth">
		              <!-- Class name was avail_class -->
		              <select required class="avail_class" type="text" style="width:100%">
		                <option selected disabled value="">Select classifier</option>
		              </select>
		            </div>
	
		            <div class="column fourth">
		            	<img id="reload1" class="inline" data-alt-src="ico/reload.png" src="ico/reloadDARK.png" style="width:30px; height:auto;">
       					<img id="garbage1" class="inline" data-alt-src="ico/garbage.png" src="ico/garbageDARK.png" style="width:30px; height:auto;">  
		            </div>		

        </div>
</form>
        <br>

      </div>
    </div>
  </div>
  
<!--   ================================================================ -->
<!--   ====================== WAITING LOGO ====================== -->
<!--   ================================================================ -->
  
  <!-- Icona Watson -->
   	<div class="content" id="waiting" style="display:none;position:absolute;">
		<img src='ico/load.svg' id="logowait" style="display:width=300px">
	</div>
		
	<!--   ================================================================ -->
	<!--   ====================== SHOW PAGE ====================== -->
	<!--   ================================================================ -->

	<div class="content" id="showtest" style="display: none;">
	
<!-- 		==================================================================== -->
<!-- 		===================== PRIMA COLONNA ================================ -->
<!-- 		==================================================================== -->
		<div class="column third">

			<div class="row clearfix">
				<div class="column full">
					<select class="show_test" type="text" style="width: 100%">
						<option selected disabled>Select Test Set to be
							analyzed...</option>
					</select>
				</div>
			</div>

			<br> <br>

			<div class="row clearfix">

				<div class="column half">
					<div class="post-preview" style="width: 100%; height: auto">
						<div class="circumference large" style="margin:auto;" id=accuracy>--.--</div>
						<p class="title center">accuracy</p>
					</div>
					<br>
					<div class="post-preview" style="width: 100%; height: auto">
						<div class="circumference large" style="margin:auto;" id=auctest>--.--</div>
						<p class="title center">AUC</p>
					</div>
				</div>

				<div class="column half">
					<div class="post-preview" style="width: 100%; height: auto">
						<div class="circumference large" style="margin:auto;" id=threshold>--.--</div>
						<p class="title center">threshold</p>
					</div>
					<br>
					<div class="post-preview" style="width: 100%; height: auto">
						<div class="circumference large" style="margin:auto;" id=indice>--.--</div>
						<p class="title center">F-positive</p>
					</div>
				</div>

			</div>

			<br> <br>

			<hr align="center" width="75%" class="middle_division">

			<div class="row clearfix">
				<div class="column full">
					<p class='ready4'>
						false positives
					</p>
					<p class='ready5'>is a result that indicates a given condition
						has been fulfilled, when it has not</p>
				</div>
				<div class="column full">
					<div class="post-preview" id="galleryFP"></div>
				</div>
			</div>

			<hr align="center" width="75%" class="middle_division">

			<div class="row clearfix">
				<div class="column full">
					<p class='ready4'>
						false negatives
					</p>
					<p class='ready5'>is where a test result indicates that a
						condition failed, while it was successful</p>
				</div>
				<div class="column full">
					<div class="post-preview" id="galleryFN"></div>
				</div>
			</div>

			<hr align="center" width="75%" class="middle_division">

		</div>

<!-- 		==================================================================== -->
<!-- 		===================== SECONDA COLONNA ================================ -->
<!-- 		==================================================================== -->
		<div class="column third">

			<div class="column full">
				<!-- 	===========================		GRAFICO ROC CURVE ============================= -->
				<div class="row clearfix">
						<div class="post-preview">
							<div>
								<p
									style="text-align: left; color: #343b43; font-weight: bold; font-size: 28px;">ROC
									curve</p>
								<p style="text-align: left; color: #A0A0A0; font-size: 14px;">In
									statistics, a receiver operating characteristic curve, or ROC
									curve, is a graphical plot that illustrates the performance of
									a binary classifier system as its discrimination threshold is
									varied.</p>
							</div>
						</div>
				</div>
				<br>
				<div class="row clearfix">
					<div class="post-preview">
						<div id="graph1"></div>
					</div>
				</div>
				<!-- 	============================= FINE ROC CURVE ============================= -->
				<hr align="center" width="75%" class="middle_division">
				<!-- 	============================= DISTRIBUTION CURVE ============================= -->
				<div class="row clearfix">
					<div class="post-preview">
						<div>
							<p
								style="text-align: left; color: #343b43; font-weight: bold; font-size: 28px;">Distribution
								curve</p>
							<p style="text-align: left; color: #A0A0A0; font-size: 14px;">In
								statistics, a receiver operating characteristic curve, or ROC
								curve, is a graphical plot that illustrates the performance of a
								binary classifier system as its discrimination threshold is
								varied.</p>
						</div>
					</div>
				</div>
				<br>
				<div class="row clearfix">
					<div class="post-preview">
						<div id="graph_histogram"></div>
					</div>
				</div>
				<!-- 	============================= FINE DISTRIBUTION CURVE ============================= -->

			</div>



		</div>
		
<!-- 		==================================================================== -->
<!-- 		===================== TERZA COLONNA ================================ -->
<!-- 		==================================================================== -->

		<div class="column third">

			<div class="column full">

				<!-- 	===========================		GRAFICO AUC CURVE ============================= -->
				<div class="row clearfix">
					<div class="post-preview">
						<div>
							<p
								style="text-align: left; color: #343b43; font-weight: bold; font-size: 28px;">AUC
								curve</p>
							<p style="text-align: left; color: #A0A0A0; font-size: 14px;">The
								area under the curve (often referred to as simply the AUC) is
								equal to the probability that a classifier will rank a randomly
								chosen positive instance higher than a randomly chosen negative
								one</p>
						</div>
					</div>
				</div>
				<br>

				<div class="row clearfix">
					<div class="post-preview">
						<div id="graph2"></div>
					</div>
				</div>
<!-- 	============================= FINE AUC CURVE ============================= -->
				<hr align="center" width="75%" class="middle_division">
			</div>



		</div>
<!-- 	============================= FINE AUC CURVE ============================= -->

	</div>

	<!-- gestione della preview immagini -->

	<div id="myModalFP" class="modal">
		<span class="close cursor" onclick="closeModal()">&times;</span>
		<div class="modal-content" id="modalcontentFP"></div>
	</div>

	<div id="myModalFN" class="modal">
		<span class="close cursor" onclick="closeModal()">&times;</span>
		<div class="modal-content" id="modalcontentFN"></div>
	</div>


</body>

<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="http://cdn.jsdelivr.net/jquery.validation/1.15.0/jquery.validate.min.js"></script>
<script src="http://cdn.jsdelivr.net/jquery.validation/1.15.0/additional-methods.min.js"></script>


<script>


//ADD button actions
$('#addicon').mouseover(function(){
	$(this).attr('src','ico/addicon.png');
});

$('#addicon').mouseleave(function(){
	$(this).attr('src',"ico/addDARK.png" );
});

var totalRowsFilled = 1;
var max = 10; // max number of allowed selectors: 10
$('#addicon').click(function(){
if(totalRowsFilled < max){
      
      var $div = $('div[id^="moltiplicandum"]:last'); // seleziono l'ultimo moltiplicandum
      
      var nextrow = parseInt( $div.prop("id").match(/\d+/g), 10 ) +1; // estraggo il numero identificativo e lo incremento
     console.log(nextrow);
      var currentrow = nextrow-1;     
      
      $("#moltiplicandum"+currentrow).clone()
      .prop('id', 'moltiplicandum'+nextrow)
      .find('input:text').val("")
      .removeAttr('class')
      .attr('name','test'+nextrow).end()
      .appendTo("#myForm"); // clono, rinomino e appendo
      
      $("#moltiplicandum"+nextrow).find("img#reload"+currentrow).attr("id","reload"+nextrow);
      $("#moltiplicandum"+nextrow).find("img#garbage"+currentrow).attr("id","garbage"+nextrow);
            
    } else {
    swal({
				title: "Warning",
				text: "Max number of entries reached. You can run max 10 tests simultaneously.",
				type: "warning"});
    }
    totalRowsFilled++;
});

//UPLOAD button actions

// Dropzone.options.myAwesomeDropzone = {
//     init: function() {
//       this.on("addedfile", function(file) {

//         // Create the remove button
//         var removeButton = Dropzone.createElement("<button>Remove file</button>");


//         // Capture the Dropzone instance as closure.
//         var _this = this;

//         // Listen to the click event
//         removeButton.addEventListener("click", function(e) {
//           // Make sure the button click doesn't submit the form:
//           e.preventDefault();
//           e.stopPropagation();

//           // Remove the file preview.
//           _this.removeFile(file);
//           // If you want to the delete the file on the server as well,
//           // you can do the AJAX request here.
//         });

//         // Add the button to the file preview element.
//         file.previewElement.appendChild(removeButton);
//       });
//     }
//   };

$('#uploadicon').mouseover(function(){
	$(this).attr('src','ico/upload.png');
});

$('#uploadicon').mouseleave(function(){
	$(this).attr('src',"ico/uploadDARK.png" );
});

$('#uploadicon').click(function(){
	//forcing page change without checking for correct test insertions
	document.location.href = 'upload.html';
});

//PLAY button actions
$('#playicon').mouseover(function(){
	$(this).attr('src','ico/play-button.png');
});

$('#playicon').mouseleave(function(){
	$(this).attr('src',"ico/play-buttonDARK.png" );
});

function startSimulation(){
directJSON = [];
		    
		    var testName = Array.prototype.map.call($(".moltiplicandum input"),(function(el){return el.value;}));
		    
			var testDataset = document.getElementsByClassName('test_set');
			var testClassifier = document.getElementsByClassName('avail_class');
		    var testname;
		    //can't use i index 'cause it was already globally living above for row counter ( shouldn't be globally reachable... )
		    for( k = 0; k < totalRowsFilled; k++ ){
		    	
		    	item = {}
		    	item["name"] = testName[k];
		    	item["test"] = testDataset[k].value;
		    	item["classifier"] = testClassifier[k].value;
		    	directJSON.push(item); 
		    }
		    
		    finalJSON = JSON.stringify(directJSON);
		    $("#simulate").fadeOut(1000);
		    setTimeout(function(){$("#waiting").fadeIn(1000)},1000);
 			setTimeout(
 			function(){getDataShow()},
 			3000);
}

//RELOAD button actions
$('body').on("mouseover","img[id*=reload]",function(){
 	$(this).attr('src',"ico/reload.png");
});

$('body').on("mouseleave","img[id*=reload]",function(){
 	$(this).attr('src',"ico/reloadDARK.png");
});

$('body').on("click","img[id*=reload]",function(){
	var $this = $(this);
	var num = parseInt($this.prop("id").substring(6));
	console.log("num reload "+num);
  	$("#moltiplicandum"+num).find('input:text').val("");
 	$("#moltiplicandum"+num).find('select').val("").find('select').val("");      
});

//GARBAGE button actions
$('body').on("mouseover","img[id*=garbage]",function(){
 	$(this).attr('src',"ico/garbage.png");
});

$('body').on("mouseleave","img[id*=garbage]",function(){
 	$(this).attr('src',"ico/garbageDARK.png");
});

$('body').on("click","img[id*=garbage]",function(){
	var $this = $(this);
	var num = parseInt($this.prop("id").substring(7));
	var size = Array.prototype.map.call($(".moltiplicandum input"),(function(el){return el.value;}));
	if(size.length>1) 
	{
	$("#moltiplicandum"+num).remove();
		totalRowsFilled--;
	console.log("TOTAL ROWS"+totalRowsFilled)
		console.log("RIGA CANCELLATA"+num)
	}
	else swal({
				title: "Warning",
				text: "You have to run at least one test",
				type: "warning"});

});

// ON CHANGE select test
	$('.show_test').on(
			'change',
			function() {
				var testname = $(".show_test").val();
				var parsedJSON = JSON.parse(finalJSON);
				for ( var j in parsedJSON) {
					if (parsedJSON[j].name == testname) {
						setParameters(cacheTestResult[j]);
						showGallery(cacheTestResult[j].falseNegativeOpt, "FN");
						showGallery(cacheTestResult[j].falsePositiveOpt, "FP");
						console.log(cacheTestResult[j]);
						DrawHistogram(cacheTestResult[j].histogramNegative,cacheTestResult[j].histogramPositive);
					}
				}
});   
    
    
    
// DROP ZONE (after the drop_zone and output divs, outside functions.js)
// function handleFileSelect(evt) {
//   evt.stopPropagation();
//   evt.preventDefault();

//   var files = evt.dataTransfer.files; // FileList object.

//   // files is a FileList of File objects. List some properties.
//   var output = [];
//   for (var i = 0, f; f = files[i]; i++) {
//     output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
//     f.size, ' bytes, last modified: ',
//     f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a',
//     '</li>');
//   }
//   document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
// }

// function handleDragOver(evt) {
//   evt.stopPropagation();
//   evt.preventDefault();
//   evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
// }

// // Setup the dnd listeners.
// var dropZone = document.getElementById('drop_zone');
// dropZone.addEventListener('dragover', handleDragOver, false);
// dropZone.addEventListener('drop', handleFileSelect, false);




</script>


<script>
populateSelectSim();
</script>

</html>
