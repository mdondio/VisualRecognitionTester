<!DOCTYPE html>
<html>

<head></head>

<!-- Main inclusions -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<!-- Functions -->
<script src="js/genericFunctions.js"></script>
<script src="js/functions.js"></script>
<!-- Carbon design scripts -->
<script src="js/index.js"></script>
<script src="js/bluemix-components.min.js"></script>
<script src="js/svgxuse.min.js"></script>
<!-- Utilities -->


<script>
createHead();
createCarbonHeader();
</script>

<body>

<div id="fade-loader" class="bx--loading-overlay">
  <div data-loading class="bx--loading">
    <svg class="bx--loading__svg" viewBox="-75 -75 150 150">
      <circle cx="0" cy="0" r="37.5" />
    </svg>
  </div>
</div> 

<div id="carbon-header"></div><br><br><br>

<div class="content" id="fade-content" style="opacity: 0">

<div class="form-container">

	<div class="row clearfix">

		<div class="column three-fourths"><h1>Upload multiclass</h1><br>
			Upload your positive and negative images; you can delete images by clicking on them. When ready, press the button to set name and parent class.
		</div>

		
		<div class="column fourth"><h1>&ensp;</h1><br>
			<center>
				<button id="submit" class="bx--btn bx--btn--primary" type="button">
				  Upload image set
				  <svg class="bx--btn__icon">
				    <use xlink:href="./ico/bluemix-icons.svg#icon--upload"></use>
				  </svg>
				</button>
			</center>
		</div>

	</div>

	<br>
			
	<div class="row clearfix">

		<div class="column half">
			<strong class="bx--label">Description</strong>
			<p class="bx--label-description">This is the description of the dataset</p>
<!-- 			<hr class="lineseparator"> -->
			<div class="bx--form-item">
			  <textarea id="descriptionedit" class="bx--text-area" rows="3" width="100%"></textarea>
			</div>


		</div>

		<div class="column half">
			<strong class="bx--label">Comments</strong>
			<p class="bx--label-description">Put here comments on the dataset</p>
<!-- 			<hr class="lineseparator"> -->
			<div class="bx--form-item">
			  <textarea id="commentsedit" class="bx--text-area" rows="3" width="100%" disabled></textarea>
			</div>
		</div>
		
	</div>
	
	<br><hr class="lineseparator">

		<div class="row clearfix">

			<form id="uploadForm" method="post" enctype="multipart/form-data">

				<div class="column full">

					<nav data-tabs class="bx--tabs" role="navigation">
					  <div class="bx--tabs-trigger" tabindex="0">
					    <a href="javascript:void(0)" class="bx--tabs-trigger-text" tabindex="-1"></a>
					    <svg width="10" height="5" viewBox="0 0 10 5" fill-rule="evenodd">
					      <path d="M10 0L5 5 0 0z"></path>
					    </svg>
					  </div>
					  <ul class="bx--tabs__nav bx--tabs__nav--hidden" role="tablist">
					    <li class="bx--tabs__nav-item bx--tabs__nav-item--selected" data-target=".tab-1" role="presentation">
					      <a id="tab-link-1" class="bx--tabs__nav-link" href="javascript:void(0)" role="tab" aria-controls="tab-panel-1" aria-selected="true">Positive images</a>
					    </li>
					    <li class="bx--tabs__nav-item" data-target=".tab-2" role="presentation">
					      <a id="tab-link-2" class="bx--tabs__nav-link" href="javascript:void(0)" role="tab" aria-controls="tab-panel-2" aria-selected="false">Positive images</a>
					    </li>
					    <li class="bx--tabs__nav-item" data-target=".tab-3" role="presentation">
					      <a id="tab-link-3" class="bx--tabs__nav-link" href="javascript:void(0)" role="tab" aria-controls="tab-panel-3" aria-selected="false">Negative images</a>
					    </li>
					  </ul>
					</nav>
					<!-- The markup below is for demonstration purposes only -->
					<div style="padding: 1rem;">
					  <div id="tab-panel-1" class="tab-1" role="tabpanel" aria-labelledby="tab-link-1" aria-hidden="false">
							<div class="column fourth">
<!-- 						    	<p class="bx--label-description"><strong>List of images containing an object of the Class 1.</strong> Only .jpg and .png files. 500kb max file size.</p> -->
						    	<div class="bx--form-item">
								  <input id="classname1" type="text" class="bx--text-input" placeholder="Hint class 1 name here">
								</div>
						    </div>
						    <div class="column three-fourths">
						    	<input type='file' id="posFiles1" name="positives1[]" multiple />
							    <br><br>
							    <div id="chosenFilesPos1"></div>
						    </div>
					  </div>
					  <div id="tab-panel-2" class="tab-2" role="tabpanel" aria-labelledby="tab-link-2" aria-hidden="true" hidden>
							<div class="column fourth">
<!-- 						    	<p class="bx--label-description"><strong>List of images containing an object of the Class 2.</strong> Only .jpg and .png files. 500kb max file size.</p> -->
						    	<div class="bx--form-item">
								  <input id="classname2" type="text" class="bx--text-input" placeholder="Hint class 2 name here">
								</div>
						    </div>
						    <div class="column three-fourths">
						    	<input type='file' id="posFiles2" name="positives2[]" multiple />
							    <br><br>
							    <div id="chosenFilesPos2"></div>
						    </div>
					  </div>
					  <div id="tab-panel-3" class="tab-3" role="tabpanel" aria-labelledby="tab-link-3" aria-hidden="true" hidden>  
						    <div class="column fourth">
						    	<div class="bx--form-item">
								  <input id="classnegative" type="text" class="bx--text-input" placeholder="Negative images" disabled>
								</div>
						    </div>
						    <div class="column three-fourths">
						    	<input type='file' id="negFiles" name="negatives[]" multiple />
							    <br><br>
							    <div id="chosenFilesNeg"></div>
						    </div>
					  </div>
					</div>
					
				</div>

    		</form>

    	</div>

    	</div>

		</div>

	</div>

<script>
loadingProcess("#fade-loader", "#fade-content");
</script>

</body>



<script>
	
	var selDiv = "";
    var storedFiles = [];

	var datasetID, datasetLabel, datasetDescription;
	var flag = false;
	var empty = 0;

    $(document).ready(function(){

        $("#posFiles1").on("change", handlerSelectedFiles);
		$("#posFiles2").on("change", handlerSelectedFiles);
        $("#negFiles").on("change", handlerSelectedFiles);

        $("#submit").click( function(e){

        	if( (empty == 3) && 
        		( $('#classname1').attr("placeholder") != $('#classname1').val() ) && 
        		( $('#classname2').attr("placeholder") != $('#classname2').val() ) &&
        		( $('#classname1').val() != $('#classname2').val() )        		
        	  ){

        		executionFormInputFromUser(e);

        	}else
        		null;

        });

        $("body").on("click", ".selFile", handlerFileRemove);

    });

	function executionFormInputFromUser(e){
	
		handlerPostCall(e);

// 		var tmpDatasetID = null , tmpDatasetLabel = null;

// 		swal({
// 			  title: "Insert Dataset ID",
// 			  html: "Give your Dataset an ID (max 30 chars):<br><br>",
// 			  type: "info",
// 			  input: "text",
// 			  customClass: 'modal-container',
// 			  confirmButtonClass: 'bx--btn bx--btn--primary margin-lr',
// 			  confirmButtonText: 'Set ID',
// 			  cancelButtonClass: 'bx--btn bx--btn--secondary margin-lr',
// 			  cancelButtonText: 'Cancel',
// 			  buttonsStyling: false,
// 			  showCancelButton: true,
// 			  allowOutsideClick: false,
// 			  allowEscapeKey: true,
// 			  inputPlaceholder: "Hint ID here...",
// 			  inputAttributes: { 'maxlength': '30'}
// 		}).then( function (result) {

// 			if( result == null || result == ""){

// 				console.log("*** ERROR on ID ***")

// 			}
// 			//Confirm on first alert
// 			else{

// 				console.log("*** Dataset ID: " + result + " ***")

// 				tmpDatasetID = result;

// 				//Second alert for Dataset label
// 				swal({
// 				  title: "Insert Dataset Label",
// 				  html: "Give your Dataset a Label (max 15 chars):<br><br>",
// 				  type: "info",
// 				  input: "text",
// 				  customClass: 'modal-container',
// 				  confirmButtonClass: 'bx--btn bx--btn--primary margin-lr',
// 				  confirmButtonText: 'Set label',
// 				  cancelButtonClass: 'bx--btn bx--btn--secondary margin-lr',
// 				  cancelButtonText: 'Cancel',
// 				  buttonsStyling: false,
// 				  showCancelButton: true,
// 				  allowOutsideClick: false,
// 				  allowEscapeKey: true,
// 				  inputPlaceholder: "Hint label here...",
// 				  inputAttributes: { 'maxlength': '15'}
// 				}).then( function(result) {

// 					if( result == null || result == "" )
// 						console.log("*** ERROR on LABEL ***")
// 					else{

// 						flag = true;
// 						console.log("*** Dataset LABEL: " + result + " ***")

// 						tmpDatasetLabel = result;

// 							//Final data protection
// 							if( flag ){

// 								datasetID = tmpDatasetID;
// 								datasetLabel = tmpDatasetLabel.toLowerCase();
// 								datasetDescription = ( $("#descriptionedit").val() );
// 								flag = false;

// 								handlerPostCall(e);

// 							}

// 						}

// 					})

// 			}//Closing confirm on first alert

// 		})//Closing  response to ID alert

	}

    function handlerSelectedFiles(e){

		empty++;
		
        var files = e.target.files;
        var filesArr = Array.prototype.slice.call(files);
        filesArr.forEach(function(f) {

            if(!f.type.match("image.*")) {
                return;
            }

            //New Property
            f.test = e.target.name;

            if( e.target.name == $('#posFiles1').attr('name') )
            	selDiv = $("#chosenFilesPos1");
            else if( e.target.name == $('#posFiles2').attr('name') )
            	selDiv = $("#chosenFilesPos2");
            else
            	selDiv = $("#chosenFilesNeg");
            //New Property end

            storedFiles.push(f);

            var reader = new FileReader();
            reader.onload = function (e) {

                var html = "<div class='blockgallery'><img border='1' width='100px' height='100px' src=\"" + e.target.result + "\" data-file='"+ f.name +"' class='selFile' title='Click to remove'><br clear=\"left\"/></div>";
                selDiv.append(html);

            }
            reader.readAsDataURL(f);
        });

    }

	function handlerPostCall(e){

	       e.preventDefault();
	       var data = new FormData();

	       data.append('type', 'insert');
	       data.append('datasetId', datasetID);
	       data.append('label', datasetLabel);
		   data.append('description', datasetDescription);

	       filesNumber = storedFiles.length;

	       for( var i = 0; i < filesNumber; i++ )
			data.append( storedFiles[i].test, storedFiles[i] );
			
			console.log(storedFiles);

   }

    function handlerFileRemove(e) {

        var file = $(this).data("file");

        for( var i = 0; i < storedFiles.length; i++ ){

            if(storedFiles[i].name === file) {
                storedFiles.splice(i,1);
                break;
            }

        }

        $(this).parent().remove();

    }

    $('#backicon').mouseover(function(){
		$(this).attr('src','ico/back.png');
	});

	$('#backicon').mouseleave(function(){
		$(this).attr('src',"ico/backDARK.png" );
	});

	$('#backicon').click(function(){
		window.history.back();
	});
</script>

</html>