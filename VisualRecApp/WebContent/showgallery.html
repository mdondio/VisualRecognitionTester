<!DOCTYPE html>
<html>

<head></head>

<!-- Main inclusions -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<!-- Functions -->
<script src="js/genericFunctions.js"></script>
<script src="js/functions.js"></script>
<!-- Carbon design scripts -->
<script src="js/index.js"></script>
<script src="js/bluemix-components.min.js"></script>
<script src="js/svgxuse.min.js"></script>
<!-- Utilities -->
<script src="js/jquery.lazy.min.js"></script>


<script>
createHead();
createCarbonHeader();
</script>

<body>

<div id="carbon-header"></div><br><br><br>


	<div class="content">

	<div class="row clearfix">

		<div class="column half"><h1>Dataset details</h1><br>
		</div>

	</div>
	
	<br>

			<div class="column fourth">
				<div class="bx--form-item">
				  <input id="shortnameedit" type="text" class="bx--text-input">
				</div>
			</div>
			<div class="column fourth">
				<div class="bx--form-item">
				  <input id="labeledit" type="text" class="bx--text-input">
				</div>			
			</div>
			
			<div class="column fourth">
				<fieldset class="bx--fieldset">
				  <div class="bx--form-item">
				    <div class="bx--radio-button-group">
					      <input id="rbTraining" class="bx--radio-button" type="radio" value="train" name="radio-button" tabindex="0">
					      <label for="rbTraining" class="bx--radio-button__label">
					        <span class="bx--radio-button__appearance"></span>
					        Training
					      </label>
					      <input id="rbTest" class="bx--radio-button" type="radio" value="test" name="radio-button" tabindex="0">
					      <label for="rbTest" class="bx--radio-button__label">
					        <span class="bx--radio-button__appearance"></span>
					        Test
					      </label>
					    </div>
				  </div>
				</fieldset>		
			</div>
			
			<div class="column fourth">
				<button id="backicon" class="bx--btn bx--btn--secondary" type="button">
					Back
				  <svg class="bx--btn__icon">
				    <use xlink:href="./ico/bluemix-icons.svg#icon--arrow--left"></use>
				  </svg>
				</button>
				<button id="saveButton" class="bx--btn bx--btn--secondary" type="button" disabled>Save</button>	
				<button class="bx--btn bx--btn--primary" type="submit" id="deleteButton">Delete</button>
			</div>
	
		<br> <br> <br> <br> <br> <br>
		
<!-- 	<div class="row clearfix"> -->

<!-- 		<div class="column half"> -->
<!-- 			<strong class="bx--label">Description</strong> -->
<!-- 			<p class="bx--label-description">This is the description of the classifier</p> -->
<!-- 			<hr class="lineseparator"> -->
<!-- 			<div class="bx--form-item"> -->
<!-- 			  <textarea id="descriptionedit" class="bx--text-area" rows="8" width="100%"></textarea> -->
<!-- 			</div> -->


<!-- 		</div> -->

<!-- 		<div class="column half"> -->
<!-- 			<strong class="bx--label">Comments</strong> -->
<!-- 			<p class="bx--label-description">Put here comments on the behaviour of the classifier</p> -->
<!-- 			<hr class="lineseparator"> -->
<!-- 			<div class="bx--form-item"> -->
<!-- 			  <textarea id="commentsedit" class="bx--text-area" rows="8" width="100%"></textarea> -->
<!-- 			</div> -->
<!-- 		</div> -->
		
<!-- 	</div> -->
		
<!-- 		<br> <br> <br> -->
		
	<div class="row clearfix">

		<div class="column half">
			<strong class="bx--label">Positive images</strong>
			<p class="bx--label-description">List of images containing an object of the selected category</p>
			<hr class="lineseparator">
			<div id="positivetestSetGallery"></div>
		</div>

		<div class="column half">
			<strong class="bx--label">Negative images</strong>
			<p class="bx--label-description">List of images not containing an object of the selected category</p>
			<hr class="lineseparator">
			<div id="negativetestSetGallery"></div>
		</div>
		
	</div>


	</div>

</body>



<script>
	
	// Lazy loading management
	$(document).ajaxStop(function () {
      testingLoading();
  	});
  	
  	// Save button management
  	var flag = 0;
  	
  	if( flag == 0 ){
  		 	
	 	if( $('#saveButton').attr("disabled") ){
	 		$('#saveButton').addClass("disabled");
	 	}else
	 		$('#saveButton').removeClass("disabled");
  		flag = 1;
  	}


	$("#descriptionedit").on("change keyup paste", function(){
    
    	$('#saveButton').attr("disabled", false);
    	$('#saveButton').removeClass("disabled");
	
	});
	
	$("#commentsedit").on("change keyup paste", function(){
    
    	$('#saveButton').attr("disabled", false);
		$('#saveButton').removeClass("disabled");
	
	});
	
	$("#labeledit").on("change keyup paste", function(){
    
    	$('#saveButton').attr("disabled", false);
    	$('#saveButton').removeClass("disabled");
	
	});
	
	$("#shortnameedit").on("change keyup paste", function(){
    
    	$('#saveButton').attr("disabled", false);
    	$('#saveButton').removeClass("disabled");
	
	});
		
	$('#deleteButton').click(function(){
	
		// Actual delete of classifier
		deleteClassifierFromDetailPage(classID, shortName);
	
	});
  	
  	$('#saveButton').click(function(){
  	
  		var shortName = ( $("#shortnameedit").val() );
//   		var descr = ( $("#descriptionedit").val() );
//   		var comm = ( $("#commentsedit").val() );
  		var label = ( $("#labeledit").val() );
  	
  		// Actual update of classifier
  		updateClassifierDetail(classID, shortName, label, descr, comm);
  		
  		$('#saveButton').attr("disabled", true);
    	$('#saveButton').addClass("disabled");
	
	});
	
	$('#backicon').click(function() {
    	window.history.back();
    });
  	  	
  	
  	// Retrieve from local storage
	var idgallery = localStorage.getItem("idgallery");
	
	shortName = returnDatasetDetail(idgallery, "_id");
	label = returnDatasetDetail(idgallery, "label");
// 	descr = returnClassifierDetail(classID, "description");
// 	comm = returnClassifierDetail(classID, "comments");
	var set = returnDatasetDetail(idgallery, "images");
	
	// Populate page with dataset attributes
	$("#shortnameedit").val(shortName);
	$("#labeledit").val(label);
// 	$("#descriptionedit").text(descr);
// 	$("#commentsedit").text(comm);

// 	buildSelectDataSet("all",'#trainingdataset');				
				
//     $("#submit").click(function(e) {
//         executionFormInputFromUser(e);
//     });

//     function executionFormInputFromUser(e) {
//         swal({
//             title: 'Are you sure?',
//             text: 'Are you sure you want to delete dataset\n\n [' + idgallery + '] ?\n\n',
//             type: 'warning',
//             showCancelButton: true,
//             confirmButtonColor: '#3085d6',
//             cancelButtonColor: '#d33',
//             confirmButtonText: 'Delete!',
//             cancelButtonText: 'No!'
//         }).then(function(isConfirm) {

//             if (isConfirm)
//                 handlerPostCall(e);
//             else {

//                 swal({
//                     title: 'Operation Aborted',
//                     text: 'This dataset is safe :)',
//                     type: 'error'
//                 })

//             }

//         })
//     }

//     function handlerPostCall(e) {

//         e.preventDefault();
//         var data = new FormData();

//         data.append('type', 'delete');
//         data.append('datasetId', idgallery);

//         var xhr = new XMLHttpRequest();
//         xhr.open('POST', 'SubmitDatasetJob', true);

//         //Operation communication progress
//         xhr.onload = function(e) {

//                 //Everything seems to be OK
//                 if (this.status == 200) {

//                     swal({
//                         title: 'Succes!',
//                         text: 'Dataset [' + idgallery + '] has been correclty deleted!',
//                         type: "success",
//                         confirmButtonColor: '#5cb85c',
//                         confirmButtonText: 'Yeah!'
//                     }).then(function(isConfirm) {

//                         if (isConfirm)
//                             window.location.href = 'home.html';

//                     })

//                 } else {

//                     var err_type = this.status;
//                     var alert_title, alert_text, alert_img = null;

//                     switch (err_type) {

//                         //BAD (cit. the Donald) request
//                         case 400:
//                             alert_title = "BAD REQUEST";
//                             alert_text = "Our server could not understand the request...\nSorry about that.\n\n";
//                             break;
//                         case 401:
//                             alert_title = "UNAUTHORIZED";
//                             alert_text = "Authentication is needed to get requested response.\n\n";
//                             break;
//                         case 404:
//                             alert_title = "NOT FOUND";
//                             alert_text = "Our Server wasn't able to retrieve the requested resource. \n\nI know right?!\n";
//                             break;
//                         case 408:
//                             alert_title = "REQUEST TIMEOUT";
//                             alert_text = "Our server did not receive a complete request message within the time that it was prepared to wait.\nHe's impatient...\n\n";
//                             break;
//                             //This is serious
//                         case 500:
//                             alert_title = "INTERNAL ERROR";
//                             alert_text = "This is on our side...sorry about that!\n\n";
//                             alert_img = 'images/internal_error.jpg';
//                             break;
//                         case 503:
//                             alert_title = "SERVICE'S OVERLOADED";
//                             alert_text = "Our server is really busy at the moment, try again in a few minutes...\n\n";
//                             break;
//                         default:
//                             alert_title = "GENERIC ERROR";
//                             alert_text = "An error occured...try again please!\n";

//                     }

//                     swal({
//                         title: '*** ' + alert_title + ' ***',
//                         text: alert_text,
//                         type: 'error',
//                         imageUrl: alert_img,
//                         imageWidth: 800,
//                         imageHeight: 200,
//                         confirmButtonColor: '#f0ad4e',
//                         confirmButtonText: 'Ok :('
//                     }).then(function(isConfirm) {

//                         if (isConfirm)
//                             location.reload();

//                     })

//                 }

//             } //Operation communication progress END

//         xhr.send(data);

//     }

    //**************************************************************************
    //********* GET FROM THE SERVER TESTSET ***************************
    //**************************************************************************

			$.ajax({
					contentType : "application/json",
					dataType : "json",
					url : 'GetDataset',
					data : "_id=",
					async : true,
					success : function(result) {
					
						$("#negativetestSetGallery").empty();
						$("#positivetestSetGallery").empty();

						for ( var i in result ){

							if (result[i]._id == idgallery) {
							
								console.log(result[i]._id);
								
								var positive_images = [];
								for( var k = 0; k < result[i].images.positive.length; k++ )								
									positive_images.push("GetImage?image_id="+result[i].images.positive[k]);
									
								var negative_images = [];
								for( var j = 0; j < result[i].images.negative.length; j++ )
									negative_images.push("GetImage?image_id="+result[i].images.negative[j]);
								
								createGallery('negativetestSetGallery', negative_images, result[i]._id + "NEG");
								createGallery('positivetestSetGallery', positive_images, result[i]._id + "POS");

							}


						}

					}
				});
	   	
			
</script>

</html>